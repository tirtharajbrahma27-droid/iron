<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>STARK LABS | ADVANCED HOLOGRAMS</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Segoe UI', monospace; }
        
        /* HUD STYLING */
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        .hud-panel { position: absolute; padding: 20px; border: 1px solid rgba(0, 255, 255, 0.3); background: rgba(0, 20, 40, 0.6); backdrop-filter: blur(5px); }
        .hud-text { color: #00ffff; text-shadow: 0 0 8px #00ffff; letter-spacing: 2px; text-transform: uppercase; font-weight: bold; }
        
        #top-left { top: 30px; left: 30px; border-left: 4px solid #00ffff; }
        #bottom-right { bottom: 30px; right: 30px; text-align: right; border-right: 4px solid #ffaa00; }
        
        /* MENU BUTTONS */
        #menu-bar { 
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); 
            display: flex; gap: 10px; pointer-events: auto; z-index: 20;
        }
        .holo-btn {
            background: rgba(0,0,0,0.8); border: 1px solid #00ffff; color: #00ffff;
            padding: 10px 20px; cursor: pointer; font-family: inherit; font-weight: bold;
            transition: 0.2s; text-transform: uppercase; letter-spacing: 1px;
        }
        .holo-btn:hover { background: #00ffff; color: #000; box-shadow: 0 0 15px #00ffff; }
        .active-btn { background: #00ffff; color: #000; box-shadow: 0 0 15px #00ffff; }

        /* START OVERLAY */
        #overlay { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 100;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        #start-btn { 
            padding: 20px 50px; border: 2px solid #00ffff; background: transparent; color: #00ffff; 
            font-size: 20px; cursor: pointer; box-shadow: 0 0 20px #00ffff; 
        }
        #input-video { display: none; }
    </style>
    
    <!-- LIBRARIES -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <!-- POST PROCESSING -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/RenderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/ShaderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/CopyShader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/UnrealBloomPass.js"></script>
</head>
<body>

    <!-- START SCREEN -->
    <div id="overlay">
        <h1 class="hud-text" style="font-size: 40px; margin-bottom: 20px;">STARK OS V2.0</h1>
        <button id="start-btn">INITIALIZE INTERFACE</button>
        <p style="color:#666; margin-top:20px;">ENSURE INTERNET CONNECTION FOR SATELLITE MAPS</p>
    </div>

    <!-- HUD -->
    <div id="ui-layer">
        <div id="top-left" class="hud-panel">
            <div class="hud-text">ACTIVE SCHEMATIC</div>
            <div id="model-name" style="color: #fff; font-size: 24px; margin-top: 5px;">EARTH (SATELLITE)</div>
        </div>
        <div id="bottom-right" class="hud-panel">
            <div class="hud-text">HAND TRACKING</div>
            <div id="status" style="color: #ff3333;">SCANNING...</div>
        </div>
    </div>

    <!-- MENU -->
    <div id="menu-bar">
        <button class="holo-btn active-btn" onclick="switchMode('earth')">1. EARTH</button>
        <button class="holo-btn" onclick="switchMode('suit')">2. MK-85 HELMET</button>
        <button class="holo-btn" onclick="switchMode('car')">3. CYBER-TRUCK</button>
        <button class="holo-btn" onclick="switchMode('jet')">4. JUMP-JET</button>
    </div>

    <div id="canvas-container"></div>
    <video id="input-video" playsinline></video>

<script>
    // --- 1. SETUP ---
    const container = document.getElementById('canvas-container');
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x000510);
    scene.fog = new THREE.FogExp2(0x000510, 0.02);

    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.z = 6;

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    container.appendChild(renderer.domElement);

    // --- 2. POST PROCESSING (GLOW) ---
    const composer = new THREE.EffectComposer(renderer);
    composer.addPass(new THREE.RenderPass(scene, camera));
    const bloom = new THREE.UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.5, 0.4, 0.85);
    bloom.threshold = 0.1; bloom.strength = 1.5; bloom.radius = 0.5;
    composer.addPass(bloom);

    // --- 3. ASSET GENERATOR (THE MODELS) ---
    const models = {};
    let currentModel = null;
    
    // COMMON MATERIAL (Holographic Blue)
    const wireMat = new THREE.MeshBasicMaterial({ color: 0x00ffff, wireframe: true, transparent: true, opacity: 0.5 });
    const solidMat = new THREE.MeshPhongMaterial({ color: 0x001133, emissive: 0x0044ff, emissiveIntensity: 0.2, shininess: 100, flatShading: true });
    const lights = new THREE.DirectionalLight(0xffffff, 1); lights.position.set(5, 5, 5); scene.add(lights); scene.add(new THREE.AmbientLight(0x404040));

    // A. EARTH (Texture Loaded)
    function createEarth() {
        const group = new THREE.Group();
        const textureLoader = new THREE.TextureLoader();
        
        // High-Res Texture (NASA Blue Marble)
        const earthGeo = new THREE.SphereGeometry(2.5, 64, 64);
        const earthMat = new THREE.MeshPhongMaterial({
            map: textureLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/earth_atmos_2048.jpg'),
            specularMap: textureLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/earth_specular_2048.jpg'),
            shininess: 15,
            emissive: 0x112244,
            emissiveIntensity: 0.1
        });
        const earth = new THREE.Mesh(earthGeo, earthMat);
        group.add(earth);

        // Atmosphere Glow
        const atmosGeo = new THREE.SphereGeometry(2.7, 64, 64);
        const atmosMat = new THREE.MeshBasicMaterial({ color: 0x00aaff, transparent: true, opacity: 0.1, side: THREE.BackSide, blending: THREE.AdditiveBlending });
        group.add(new THREE.Mesh(atmosGeo, atmosMat));
        
        return group;
    }

    // B. MK-85 HELMET (Procedural Geometry)
    function createHelmet() {
        const group = new THREE.Group();
        // Main Head
        const head = new THREE.Mesh(new THREE.IcosahedronGeometry(1.5, 2), wireMat);
        group.add(head);
        // Faceplate
        const face = new THREE.Mesh(new THREE.BoxGeometry(1.2, 1.8, 1), solidMat);
        face.position.z = 1;
        group.add(face);
        // Eyes
        const eyeGeo = new THREE.BoxGeometry(0.4, 0.1, 0.1);
        const eyeMat = new THREE.MeshBasicMaterial({ color: 0xffffff });
        const leftEye = new THREE.Mesh(eyeGeo, eyeMat); leftEye.position.set(-0.3, 0.1, 1.5);
        const rightEye = new THREE.Mesh(eyeGeo, eyeMat); rightEye.position.set(0.3, 0.1, 1.5);
        group.add(leftEye); group.add(rightEye);
        return group;
    }

    // C. CYBER TRUCK (Primitive Shapes)
    function createCar() {
        const group = new THREE.Group();
        // Body
        const body = new THREE.Mesh(new THREE.BoxGeometry(4, 1, 2), wireMat);
        group.add(body);
        // Cabin
        const cabin = new THREE.Mesh(new THREE.ConeGeometry(1.5, 2, 4), wireMat);
        cabin.rotation.y = Math.PI / 4; cabin.position.y = 1;
        group.add(cabin);
        // Wheels
        const wGeo = new THREE.CylinderGeometry(0.5, 0.5, 0.5, 16);
        const w1 = new THREE.Mesh(wGeo, solidMat); w1.rotation.x = Math.PI/2; w1.position.set(-1.5, -0.5, 1);
        const w2 = new THREE.Mesh(wGeo, solidMat); w2.rotation.x = Math.PI/2; w2.position.set(1.5, -0.5, 1);
        const w3 = new THREE.Mesh(wGeo, solidMat); w3.rotation.x = Math.PI/2; w3.position.set(-1.5, -0.5, -1);
        const w4 = new THREE.Mesh(wGeo, solidMat); w4.rotation.x = Math.PI/2; w4.position.set(1.5, -0.5, -1);
        group.add(w1, w2, w3, w4);
        return group;
    }

    // D. JET (Primitive Shapes)
    function createJet() {
        const group = new THREE.Group();
        // Fuselage
        const body = new THREE.Mesh(new THREE.ConeGeometry(0.8, 4, 16), wireMat);
        body.rotation.x = Math.PI / 2;
        group.add(body);
        // Wings
        const wing = new THREE.Mesh(new THREE.BoxGeometry(4, 0.1, 1), wireMat);
        wing.position.z = 0.5;
        group.add(wing);
        // Thrusters
        const t1 = new THREE.Mesh(new THREE.CylinderGeometry(0.3, 0.5, 1, 16), solidMat); t1.rotation.x=Math.PI/2; t1.position.set(0.8, 0, 1.5);
        const t2 = new THREE.Mesh(new THREE.CylinderGeometry(0.3, 0.5, 1, 16), solidMat); t2.rotation.x=Math.PI/2; t2.position.set(-0.8, 0, 1.5);
        group.add(t1, t2);
        return group;
    }

    // Initialize Models
    models.earth = createEarth();
    models.suit = createHelmet();
    models.car = createCar();
    models.jet = createJet();

    function switchMode(name) {
        if(currentModel) scene.remove(currentModel);
        currentModel = models[name];
        scene.add(currentModel);
        document.getElementById('model-name').innerText = name.toUpperCase();
        
        // Update Buttons
        document.querySelectorAll('.holo-btn').forEach(b => b.classList.remove('active-btn'));
        event.target.classList.add('active-btn');
    }
    
    // Default
    switchMode('earth');


    // --- 4. LOGIC & TRACKING ---
    let state = { rotX: 0, rotY: 0, explode: 1 };
    
    const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
    hands.setOptions({ maxNumHands: 2, minDetectionConfidence: 0.7, minTrackingConfidence: 0.7 });
    
    hands.onResults(results => {
        const detected = results.multiHandLandmarks ? results.multiHandLandmarks.length : 0;
        const statusDiv = document.getElementById('status');
        
        if (detected > 0) {
            statusDiv.innerText = "ONLINE - " + detected + " HAND(S)";
            statusDiv.style.color = "#00ff00";
            
            // Rotation Logic (Index Finger)
            const lm = results.multiHandLandmarks[0];
            state.rotY = (lm[9].x - 0.5) * 5;
            state.rotX = (lm[9].y - 0.5) * 5;

            // Explosion Logic (Two Hands)
            if (detected === 2) {
                const h1 = results.multiHandLandmarks[0][9];
                const h2 = results.multiHandLandmarks[1][9];
                const dist = Math.hypot(h1.x - h2.x, h1.y - h2.y);
                state.explode = 1 + (dist * 2); // Scale modifier
            } else {
                state.explode = 1;
            }
        } else {
            statusDiv.innerText = "SCANNING...";
            statusDiv.style.color = "#ff3333";
            state.explode = 1;
        }
    });

    // --- 5. START SYSTEM ---
    document.getElementById('start-btn').addEventListener('click', async () => {
        const video = document.getElementById('input-video');
        const stream = await navigator.mediaDevices.getUserMedia({ video: { width: 640, height: 480 } });
        video.srcObject = stream;
        video.play();
        
        document.getElementById('overlay').style.display = 'none';
        
        const camera = new Camera(video, {
            onFrame: async () => { await hands.send({image: video}); },
            width: 640, height: 480
        });
        camera.start();
    });

    // --- 6. ANIMATION LOOP ---
    function animate() {
        requestAnimationFrame(animate);
        
        if(currentModel) {
            // Smooth Rotation
            currentModel.rotation.x += (state.rotX - currentModel.rotation.x) * 0.1;
            currentModel.rotation.y += (state.rotY - currentModel.rotation.y) * 0.1;
            
            // Auto spin if idle
            if(Math.abs(state.rotX) < 0.1) currentModel.rotation.y += 0.002;

            // Explode Effect (Scaling children away from center)
            currentModel.children.forEach(child => {
                // If child is offset, move it further out
                if(state.explode > 1.1) {
                    child.position.multiplyScalar(1.02); // Expand
                } else {
                    // Return to original position (Approximate for simple demo)
                   // Note: A real explode system requires storing original positions.
                   // For this simple demo, we just scale the whole group
                   currentModel.scale.setScalar(state.explode);
                }
            });
        }

        composer.render();
    }
    
    // Keyboard Shortcuts
    window.addEventListener('keydown', (e) => {
        if(e.key === '1') switchMode('earth');
        if(e.key === '2') switchMode('suit');
        if(e.key === '3') switchMode('car');
        if(e.key === '4') switchMode('jet');
    });
    
    // Handle resize
    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
        composer.setSize(window.innerWidth, window.innerHeight);
    });

    animate();

</script>
</body>
</html>
